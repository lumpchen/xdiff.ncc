!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?e(require("jquery")):e(jQuery)}(function(m){"use strict";var o;m.support.htmlMenuitem="HTMLMenuItemElement"in window,m.support.htmlCommand="HTMLCommandElement"in window,m.support.eventSelectstart="onselectstart"in document.documentElement,m.ui&&m.widget||(m.cleanData=(o=m.cleanData,function(e){var t,n,a;for(a=0;null!=e[a];a++){n=e[a];try{(t=m._data(n,"events"))&&t.remove&&m(n).triggerHandler("remove")}catch(e){}}o(e)}));var c=null,u=!1,d=m(window),p=0,f={},h={},x={},v={selector:null,appendTo:null,trigger:"right",autoHide:!1,delay:200,reposition:!0,selectableSubMenu:!1,classNames:{hover:"context-menu-hover",disabled:"context-menu-disabled",visible:"context-menu-visible",notSelectable:"context-menu-not-selectable",icon:"context-menu-icon",iconEdit:"context-menu-icon-edit",iconCut:"context-menu-icon-cut",iconCopy:"context-menu-icon-copy",iconPaste:"context-menu-icon-paste",iconDelete:"context-menu-icon-delete",iconAdd:"context-menu-icon-add",iconQuit:"context-menu-icon-quit",iconLoadingClass:"context-menu-icon-loading"},determinePosition:function(e){if(m.ui&&m.ui.position)e.css("display","block").position({my:"center top",at:"center bottom",of:this,offset:"0 5",collision:"fit"}).css("display","none");else{var t=this.offset();t.top+=this.outerHeight(),t.left+=this.outerWidth()/2-e.outerWidth()/2,e.css(t)}},position:function(e,t,n){var a;if(t||n){a="maintain"===t&&"maintain"===n?e.$menu.position():{top:n,left:t};var o=d.scrollTop()+d.height(),s=d.scrollLeft()+d.width(),i=e.$menu.outerHeight(),c=e.$menu.outerWidth();a.top+i>o&&(a.top-=i),a.top<0&&(a.top=0),a.left+c>s&&(a.left-=c),a.left<0&&(a.left=0),e.$menu.css(a)}else e.determinePosition.call(this,e.$menu)},positionSubmenu:function(e){if(void 0!==e)if(m.ui&&m.ui.position)e.css("display","block").position({my:"left top-5",at:"right top",of:this,collision:"flipfit fit"}).css("display","");else{var t={top:-9,left:this.outerWidth()-5};e.css(t)}},zIndex:1,animation:{duration:50,show:"slideDown",hide:"slideUp"},events:{show:m.noop,hide:m.noop},callback:null,items:{}},s={timer:null,pageX:null,pageY:null},g={abortevent:function(e){e.preventDefault(),e.stopImmediatePropagation()},contextmenu:function(e){var t=m(this);if("right"===e.data.trigger&&(e.preventDefault(),e.stopImmediatePropagation()),!("right"!==e.data.trigger&&"demand"!==e.data.trigger&&e.originalEvent||!(void 0===e.mouseButton||!e.data||"left"===e.data.trigger&&0===e.mouseButton||"right"===e.data.trigger&&2===e.mouseButton)||t.hasClass("context-menu-active")||t.hasClass("context-menu-disabled"))){if(c=t,e.data.build){var n=e.data.build(c,e);if(!1===n)return;if(e.data=m.extend(!0,{},v,e.data,n||{}),!e.data.items||m.isEmptyObject(e.data.items))throw window.console&&(console.error||console.log).call(console,"No items specified to show in contextMenu"),new Error("No Items specified");e.data.$trigger=c,b.create(e.data)}var a=!1;for(var o in e.data.items)e.data.items.hasOwnProperty(o)&&(m.isFunction(e.data.items[o].visible)?e.data.items[o].visible.call(m(e.currentTarget),o,e.data):void 0===e.data.items[o]||!e.data.items[o].visible||!0===e.data.items[o].visible)&&(a=!0);a&&b.show.call(t,e.data,e.pageX,e.pageY)}},click:function(e){e.preventDefault(),e.stopImmediatePropagation(),m(this).trigger(m.Event("contextmenu",{data:e.data,pageX:e.pageX,pageY:e.pageY}))},mousedown:function(e){var t=m(this);c&&c.length&&!c.is(t)&&c.data("contextMenu").$menu.trigger("contextmenu:hide"),2===e.button&&(c=t.data("contextMenuActive",!0))},mouseup:function(e){var t=m(this);t.data("contextMenuActive")&&c&&c.length&&c.is(t)&&!t.hasClass("context-menu-disabled")&&(e.preventDefault(),e.stopImmediatePropagation(),(c=t).trigger(m.Event("contextmenu",{data:e.data,pageX:e.pageX,pageY:e.pageY}))),t.removeData("contextMenuActive")},mouseenter:function(e){var t=m(this),n=m(e.relatedTarget),a=m(document);n.is(".context-menu-list")||n.closest(".context-menu-list").length||c&&c.length||(s.pageX=e.pageX,s.pageY=e.pageY,s.data=e.data,a.on("mousemove.contextMenuShow",g.mousemove),s.timer=setTimeout(function(){s.timer=null,a.off("mousemove.contextMenuShow"),(c=t).trigger(m.Event("contextmenu",{data:s.data,pageX:s.pageX,pageY:s.pageY}))},e.data.delay))},mousemove:function(e){s.pageX=e.pageX,s.pageY=e.pageY},mouseleave:function(e){var t=m(e.relatedTarget);if(!t.is(".context-menu-list")&&!t.closest(".context-menu-list").length){try{clearTimeout(s.timer)}catch(e){}s.timer=null}},layerClick:function(o){var s,i,c=m(this).data("contextMenuRoot"),l=o.button,r=o.pageX,u=o.pageY;o.preventDefault(),o.stopImmediatePropagation(),setTimeout(function(){var e,t="left"===c.trigger&&0===l||"right"===c.trigger&&2===l;if(document.elementFromPoint&&c.$layer){if(c.$layer.hide(),(s=document.elementFromPoint(r-d.scrollLeft(),u-d.scrollTop())).isContentEditable){var n=document.createRange(),a=window.getSelection();n.selectNode(s),n.collapse(!0),a.removeAllRanges(),a.addRange(n)}c.$layer.show()}if(c.reposition&&t)if(document.elementFromPoint){if(c.$trigger.is(s)||c.$trigger.has(s).length)return void c.position.call(c.$trigger,c,r,u)}else if(i=c.$trigger.offset(),e=m(window),i.top+=e.scrollTop(),i.top<=o.pageY&&(i.left+=e.scrollLeft(),i.left<=o.pageX&&(i.bottom=i.top+c.$trigger.outerHeight(),i.bottom>=o.pageY&&(i.right=i.left+c.$trigger.outerWidth(),i.right>=o.pageX))))return void c.position.call(c.$trigger,c,r,u);s&&t&&c.$trigger.one("contextmenu:hidden",function(){m(s).contextMenu({x:r,y:u,button:l})}),null!=c&&null!==c.$menu&&void 0!==c.$menu&&c.$menu.trigger("contextmenu:hide")},50)},keyStop:function(e,t){t.isInput||e.preventDefault(),e.stopPropagation()},key:function(e){var t={};c&&(t=c.data("contextMenu")||{}),void 0===t.zIndex&&(t.zIndex=0);var n=0,a=function(e){""!==e.style.zIndex?n=e.style.zIndex:null!==e.offsetParent&&void 0!==e.offsetParent?a(e.offsetParent):null!==e.parentElement&&void 0!==e.parentElement&&a(e.parentElement)};if(a(e.target),!(n>t.zIndex)){switch(e.keyCode){case 9:case 38:if(g.keyStop(e,t),t.isInput){if(9===e.keyCode&&e.shiftKey)return e.preventDefault(),t.$selected&&t.$selected.find("input, textarea, select").blur(),void(null!==t.$menu&&void 0!==t.$menu&&t.$menu.trigger("prevcommand"));if(38===e.keyCode&&"checkbox"===t.$selected.find("input, textarea, select").prop("type"))return void e.preventDefault()}else if(9!==e.keyCode||e.shiftKey)return void(null!==t.$menu&&void 0!==t.$menu&&t.$menu.trigger("prevcommand"));break;case 40:if(g.keyStop(e,t),!t.isInput)return void(null!==t.$menu&&void 0!==t.$menu&&t.$menu.trigger("nextcommand"));if(9===e.keyCode)return e.preventDefault(),t.$selected&&t.$selected.find("input, textarea, select").blur(),void(null!==t.$menu&&void 0!==t.$menu&&t.$menu.trigger("nextcommand"));if(40===e.keyCode&&"checkbox"===t.$selected.find("input, textarea, select").prop("type"))return void e.preventDefault();break;case 37:if(g.keyStop(e,t),t.isInput||!t.$selected||!t.$selected.length)break;if(t.$selected.parent().hasClass("context-menu-root"))break;var o=t.$selected.parent().parent();return t.$selected.trigger("contextmenu:blur"),void(t.$selected=o);case 39:if(g.keyStop(e,t),t.isInput||!t.$selected||!t.$selected.length)break;var s=t.$selected.data("contextMenu")||{};if(s.$menu&&t.$selected.hasClass("context-menu-submenu"))return t.$selected=null,s.$selected=null,void s.$menu.trigger("nextcommand");break;case 35:case 36:return t.$selected&&t.$selected.find("input, textarea, select").length?void 0:((t.$selected&&t.$selected.parent()||t.$menu).children(":not(."+t.classNames.disabled+", ."+t.classNames.notSelectable+")")[36===e.keyCode?"first":"last"]().trigger("contextmenu:focus"),void e.preventDefault());case 13:if(g.keyStop(e,t),t.isInput){if(t.$selected&&!t.$selected.is("textarea, select"))return void e.preventDefault();break}return void(void 0!==t.$selected&&null!==t.$selected&&t.$selected.trigger("mouseup"));case 32:case 33:case 34:return void g.keyStop(e,t);case 27:return g.keyStop(e,t),void(null!==t.$menu&&void 0!==t.$menu&&t.$menu.trigger("contextmenu:hide"));default:var i=String.fromCharCode(e.keyCode).toUpperCase();if(t.accesskeys&&t.accesskeys[i])return void t.accesskeys[i].$node.trigger(t.accesskeys[i].$menu?"contextmenu:focus":"mouseup")}e.stopPropagation(),void 0!==t.$selected&&null!==t.$selected&&t.$selected.trigger(e)}},prevItem:function(e){e.stopPropagation();var t=m(this).data("contextMenu")||{},n=m(this).data("contextMenuRoot")||{};if(t.$selected){var a=t.$selected;(t=t.$selected.parent().data("contextMenu")||{}).$selected=a}for(var o=t.$menu.children(),s=t.$selected&&t.$selected.prev().length?t.$selected.prev():o.last(),i=s;s.hasClass(n.classNames.disabled)||s.hasClass(n.classNames.notSelectable)||s.is(":hidden");)if((s=s.prev().length?s.prev():o.last()).is(i))return;t.$selected&&g.itemMouseleave.call(t.$selected.get(0),e),g.itemMouseenter.call(s.get(0),e);var c=s.find("input, textarea, select");c.length&&c.focus()},nextItem:function(e){e.stopPropagation();var t=m(this).data("contextMenu")||{},n=m(this).data("contextMenuRoot")||{};if(t.$selected){var a=t.$selected;(t=t.$selected.parent().data("contextMenu")||{}).$selected=a}for(var o=t.$menu.children(),s=t.$selected&&t.$selected.next().length?t.$selected.next():o.first(),i=s;s.hasClass(n.classNames.disabled)||s.hasClass(n.classNames.notSelectable)||s.is(":hidden");)if((s=s.next().length?s.next():o.first()).is(i))return;t.$selected&&g.itemMouseleave.call(t.$selected.get(0),e),g.itemMouseenter.call(s.get(0),e);var c=s.find("input, textarea, select");c.length&&c.focus()},focusInput:function(){var e=m(this).closest(".context-menu-item"),t=e.data(),n=t.contextMenu,a=t.contextMenuRoot;a.$selected=n.$selected=e,a.isInput=n.isInput=!0},blurInput:function(){var e=m(this).closest(".context-menu-item").data(),t=e.contextMenu;e.contextMenuRoot.isInput=t.isInput=!1},menuMouseenter:function(){m(this).data().contextMenuRoot.hovering=!0},menuMouseleave:function(e){var t=m(this).data().contextMenuRoot;t.$layer&&t.$layer.is(e.relatedTarget)&&(t.hovering=!1)},itemMouseenter:function(e){var t=m(this),n=t.data(),a=n.contextMenu,o=n.contextMenuRoot;o.hovering=!0,e&&o.$layer&&o.$layer.is(e.relatedTarget)&&(e.preventDefault(),e.stopImmediatePropagation()),(a.$menu?a:o).$menu.children("."+o.classNames.hover).trigger("contextmenu:blur").children(".hover").trigger("contextmenu:blur"),t.hasClass(o.classNames.disabled)||t.hasClass(o.classNames.notSelectable)?a.$selected=null:t.trigger("contextmenu:focus")},itemMouseleave:function(e){var t=m(this),n=t.data(),a=n.contextMenu,o=n.contextMenuRoot;if(o!==a&&o.$layer&&o.$layer.is(e.relatedTarget))return void 0!==o.$selected&&null!==o.$selected&&o.$selected.trigger("contextmenu:blur"),e.preventDefault(),e.stopImmediatePropagation(),void(o.$selected=a.$selected=a.$node);t.trigger("contextmenu:blur")},itemClick:function(e){var t,n=m(this),a=n.data(),o=a.contextMenu,s=a.contextMenuRoot,i=a.contextMenuKey;if(!(!o.items[i]||n.is("."+s.classNames.disabled+", .context-menu-separator, ."+s.classNames.notSelectable)||n.is(".context-menu-submenu")&&!1===s.selectableSubMenu)){if(e.preventDefault(),e.stopImmediatePropagation(),m.isFunction(o.callbacks[i])&&Object.prototype.hasOwnProperty.call(o.callbacks,i))t=o.callbacks[i];else{if(!m.isFunction(s.callback))return;t=s.callback}!1!==t.call(s.$trigger,i,s)?s.$menu.trigger("contextmenu:hide"):s.$menu.parent().length&&b.update.call(s.$trigger,s)}},inputClick:function(e){e.stopImmediatePropagation()},hideMenu:function(e,t){var n=m(this).data("contextMenuRoot");b.hide.call(n.$trigger,n,t&&t.force)},focusItem:function(e){e.stopPropagation();var t=m(this),n=t.data(),a=n.contextMenu,o=n.contextMenuRoot;t.hasClass(o.classNames.disabled)||t.hasClass(o.classNames.notSelectable)||(t.addClass([o.classNames.hover,o.classNames.visible].join(" ")).parent().find(".context-menu-item").not(t).removeClass(o.classNames.visible).filter("."+o.classNames.hover).trigger("contextmenu:blur"),a.$selected=o.$selected=t,a.$node&&o.positionSubmenu.call(a.$node,a.$menu))},blurItem:function(e){e.stopPropagation();var t=m(this),n=t.data(),a=n.contextMenu,o=n.contextMenuRoot;a.autoHide&&t.removeClass(o.classNames.visible),t.removeClass(o.classNames.hover),a.$selected=null}},b={show:function(n,e,t){var a=m(this),o={};if(m("#context-menu-layer").trigger("mousedown"),n.$trigger=a,!1!==n.events.show.call(a,n)){if(b.update.call(a,n),n.position.call(a,n,e,t),n.zIndex){var s=n.zIndex;"function"==typeof n.zIndex&&(s=n.zIndex.call(a,n)),o.zIndex=function(){for(var e=0,t=a;e=Math.max(e,parseInt(t.css("z-index"),10)||0),(t=t.parent())&&t.length&&!(-1<"html body".indexOf(t.prop("nodeName").toLowerCase())););return e}()+s}b.layer.call(n.$menu,n,o.zIndex),n.$menu.find("ul").css("zIndex",o.zIndex+1),n.$menu.css(o)[n.animation.show](n.animation.duration,function(){a.trigger("contextmenu:visible")}),a.data("contextMenu",n).addClass("context-menu-active"),m(document).off("keydown.contextMenu").on("keydown.contextMenu",g.key),n.autoHide&&m(document).on("mousemove.contextMenuAutoHide",function(e){var t=a.offset();t.right=t.left+a.outerWidth(),t.bottom=t.top+a.outerHeight(),!n.$layer||n.hovering||e.pageX>=t.left&&e.pageX<=t.right&&e.pageY>=t.top&&e.pageY<=t.bottom||setTimeout(function(){n.hovering||null===n.$menu||void 0===n.$menu||n.$menu.trigger("contextmenu:hide")},50)})}else c=null},hide:function(t,e){var n=m(this);if(t=t||n.data("contextMenu")||{},e||!t.events||!1!==t.events.hide.call(n,t)){if(n.removeData("contextMenu").removeClass("context-menu-active"),t.$layer){setTimeout((a=t.$layer,function(){a.remove()}),10);try{delete t.$layer}catch(e){t.$layer=null}}var a;c=null,t.$menu.find("."+t.classNames.hover).trigger("contextmenu:blur"),t.$selected=null,t.$menu.find("."+t.classNames.visible).removeClass(t.classNames.visible),m(document).off(".contextMenuAutoHide").off("keydown.contextMenu"),t.$menu&&t.$menu[t.animation.hide](t.animation.duration,function(){t.build&&(t.$menu.remove(),m.each(t,function(e){switch(e){case"ns":case"selector":case"build":case"trigger":return!0;default:t[e]=void 0;try{delete t[e]}catch(e){}return!0}})),setTimeout(function(){n.trigger("contextmenu:hidden")},10)})}},create:function(r,u){function d(e){var t=m("<span></span>");if(e._accesskey)e._beforeAccesskey&&t.append(document.createTextNode(e._beforeAccesskey)),m("<span></span>").addClass("context-menu-accesskey").text(e._accesskey).appendTo(t),e._afterAccesskey&&t.append(document.createTextNode(e._afterAccesskey));else if(e.isHtmlName){if(void 0!==e.accesskey)throw new Error("accesskeys are not compatible with HTML names and cannot be used together in the same item");t.html(e.name)}else t.text(e.name);return t}void 0===u&&(u=r),r.$menu=m('<ul class="context-menu-list"></ul>').addClass(r.className||"").data({contextMenu:r,contextMenuRoot:u}),m.each(["callbacks","commands","inputs"],function(e,t){r[t]={},u[t]||(u[t]={})}),u.accesskeys||(u.accesskeys={}),m.each(r.items,function(n,o){var e=m('<li class="context-menu-item"></li>').addClass(o.className||""),t=null,a=null;if(e.on("click",m.noop),"string"!=typeof o&&"cm_separator"!==o.type||(o={type:"cm_seperator"}),o.$node=e.data({contextMenu:r,contextMenuRoot:u,contextMenuKey:n}),void 0!==o.accesskey)for(var s,i=function(){for(var e,t=o.accesskey.split(/\s+/),n=[],a=0;e=t[a];a++)e=e.charAt(0).toUpperCase(),n.push(e);return n}(),c=0;s=i[c];c++)if(!u.accesskeys[s]){var l=(u.accesskeys[s]=o).name.match(new RegExp("^(.*?)("+s+")(.*)$","i"));l&&(o._beforeAccesskey=l[1],o._accesskey=l[2],o._afterAccesskey=l[3]);break}if(o.type&&x[o.type])x[o.type].call(e,o,r,u),m.each([r,u],function(e,t){t.commands[n]=o,!m.isFunction(o.callback)||void 0!==t.callbacks[n]&&void 0!==r.type||(t.callbacks[n]=o.callback)});else{switch("cm_seperator"===o.type?e.addClass("context-menu-separator "+u.classNames.notSelectable):"html"===o.type?e.addClass("context-menu-html "+u.classNames.notSelectable):"sub"===o.type||(o.type?(t=m("<label></label>").appendTo(e),d(o).appendTo(t),e.addClass("context-menu-input"),r.hasTypes=!0,m.each([r,u],function(e,t){t.commands[n]=o,t.inputs[n]=o})):o.items&&(o.type="sub")),o.type){case"cm_seperator":break;case"text":a=m('<input type="text" value="1" name="" />').attr("name","context-menu-input-"+n).val(o.value||"").appendTo(t);break;case"textarea":a=m('<textarea name=""></textarea>').attr("name","context-menu-input-"+n).val(o.value||"").appendTo(t),o.height&&a.height(o.height);break;case"checkbox":a=m('<input type="checkbox" value="1" name="" />').attr("name","context-menu-input-"+n).val(o.value||"").prop("checked",!!o.selected).prependTo(t);break;case"radio":a=m('<input type="radio" value="1" name="" />').attr("name","context-menu-input-"+o.radio).val(o.value||"").prop("checked",!!o.selected).prependTo(t);break;case"select":a=m('<select name=""></select>').attr("name","context-menu-input-"+n).appendTo(t),o.options&&(m.each(o.options,function(e,t){m("<option></option>").val(e).text(t).appendTo(a)}),a.val(o.selected));break;case"sub":d(o).appendTo(e),o.appendTo=o.$node,e.data("contextMenu",o).addClass("context-menu-submenu"),o.callback=null,"function"==typeof o.items.then?b.processPromises(o,u,o.items):b.create(o,u);break;case"html":m(o.html).appendTo(e);break;default:m.each([r,u],function(e,t){t.commands[n]=o,!m.isFunction(o.callback)||void 0!==t.callbacks[n]&&void 0!==r.type||(t.callbacks[n]=o.callback)}),d(o).appendTo(e)}o.type&&"sub"!==o.type&&"html"!==o.type&&"cm_seperator"!==o.type&&(a.on("focus",g.focusInput).on("blur",g.blurInput),o.events&&a.on(o.events,r)),o.icon&&(m.isFunction(o.icon)?o._icon=o.icon.call(this,this,e,n,o):"string"==typeof o.icon&&"fa-"===o.icon.substring(0,3)?o._icon=u.classNames.icon+" "+u.classNames.icon+"--fa fa "+o.icon:o._icon=u.classNames.icon+" "+u.classNames.icon+"-"+o.icon,e.addClass(o._icon))}o.$input=a,o.$label=t,e.appendTo(r.$menu),!r.hasTypes&&m.support.eventSelectstart&&e.on("selectstart.disableTextSelect",g.abortevent)}),r.$node||r.$menu.css("display","none").addClass("context-menu-root"),r.$menu.appendTo(r.appendTo||document.body)},resize:function(e,t){var n;e.css({position:"absolute",display:"block"}),e.data("width",(n=e.get(0)).getBoundingClientRect?Math.ceil(n.getBoundingClientRect().width):e.outerWidth()+1),e.css({position:"static",minWidth:"0px",maxWidth:"100000px"}),e.find("> li > ul").each(function(){b.resize(m(this),!0)}),t||e.find("ul").addBack().css({position:"",display:"",minWidth:"",maxWidth:""}).outerWidth(function(){return m(this).data("width")})},update:function(o,s){var i=this;void 0===s&&(s=o,b.resize(o.$menu)),o.$menu.children().each(function(){var e=m(this),t=e.data("contextMenuKey"),n=o.items[t],a=m.isFunction(n.disabled)&&n.disabled.call(i,t,s)||!0===n.disabled;if(e[(m.isFunction(n.visible)?n.visible.call(i,t,s):void 0===n.visible||!0===n.visible)?"show":"hide"](),e[a?"addClass":"removeClass"](s.classNames.disabled),m.isFunction(n.icon)&&(e.removeClass(n._icon),n._icon=n.icon.call(this,i,e,t,n),e.addClass(n._icon)),n.type)switch(e.find("input, select, textarea").prop("disabled",a),n.type){case"text":case"textarea":n.$input.val(n.value||"");break;case"checkbox":case"radio":n.$input.val(n.value||"").prop("checked",!!n.selected);break;case"select":n.$input.val(n.selected||"")}n.$menu&&b.update.call(i,n,s)})},layer:function(e,t){var n=e.$layer=m('<div id="context-menu-layer"></div>').css({height:d.height(),width:d.width(),display:"block",position:"fixed","z-index":t,top:0,left:0,opacity:0,filter:"alpha(opacity=0)","background-color":"#000"}).data("contextMenuRoot",e).insertBefore(this).on("contextmenu",g.abortevent).on("mousedown",g.layerClick);return void 0===document.body.style.maxWidth&&n.css({position:"absolute",height:m(document).height()}),n},processPromises:function(e,t,n){function a(e,t,n){void 0===n?(n={error:{name:"No items and no error item",icon:"context-menu-icon context-menu-icon-quit"}},window.console&&(console.error||console.log).call(console,'When you reject a promise, provide an "items" object, equal to normal sub-menu items')):"string"==typeof n&&(n={error:{name:n}}),o(e,t,n)}function o(e,t,n){void 0!==t.$menu&&t.$menu.is(":visible")&&(e.$node.removeClass(t.classNames.iconLoadingClass),e.items=n,b.create(e,t,!0),b.update(e,t),t.positionSubmenu.call(e.$node,e.$menu))}e.$node.addClass(t.classNames.iconLoadingClass),n.then(function(e,t,n){void 0===n&&a(void 0),o(e,t,n)}.bind(this,e,t),a.bind(this,e,t))}};function l(e){return e.id&&m('label[for="'+e.id+'"]').val()||e.name}m.fn.contextMenu=function(e){var t=this,n=e;if(0<this.length)if(void 0===e)this.first().trigger("contextmenu");else if(void 0!==e.x&&void 0!==e.y)this.first().trigger(m.Event("contextmenu",{pageX:e.x,pageY:e.y,mouseButton:e.button}));else if("hide"===e){var a=this.first().data("contextMenu")?this.first().data("contextMenu").$menu:null;a&&a.trigger("contextmenu:hide")}else"destroy"===e?m.contextMenu("destroy",{context:this}):m.isPlainObject(e)?(e.context=this,m.contextMenu("create",e)):e?this.removeClass("context-menu-disabled"):e||this.addClass("context-menu-disabled");else m.each(h,function(){this.selector===t.selector&&(n.data=this,m.extend(n.data,{trigger:"demand"}))}),g.contextmenu.call(n.target,n);return this},m.contextMenu=function(e,t){"string"!=typeof e&&(t=e,e="create"),"string"==typeof t?t={selector:t}:void 0===t&&(t={});var n=m.extend(!0,{},v,t||{}),a=m(document),o=a,s=!1;switch(n.context&&n.context.length?(o=m(n.context).first(),n.context=o.get(0),s=!m(n.context).is(document)):n.context=document,e){case"create":if(!n.selector)throw new Error("No selector specified");if(n.selector.match(/.context-menu-(list|item|input)($|\s)/))throw new Error('Cannot bind to selector "'+n.selector+'" as it contains a reserved className');if(!n.build&&(!n.items||m.isEmptyObject(n.items)))throw new Error("No Items specified");if(p++,n.ns=".contextMenu"+p,s||(f[n.selector]=n.ns),(h[n.ns]=n).trigger||(n.trigger="right"),!u){var i="click"===n.itemClickEvent?"click.contextMenu":"mouseup.contextMenu",c={"contextmenu:focus.contextMenu":g.focusItem,"contextmenu:blur.contextMenu":g.blurItem,"contextmenu.contextMenu":g.abortevent,"mouseenter.contextMenu":g.itemMouseenter,"mouseleave.contextMenu":g.itemMouseleave};c[i]=g.itemClick,a.on({"contextmenu:hide.contextMenu":g.hideMenu,"prevcommand.contextMenu":g.prevItem,"nextcommand.contextMenu":g.nextItem,"contextmenu.contextMenu":g.abortevent,"mouseenter.contextMenu":g.menuMouseenter,"mouseleave.contextMenu":g.menuMouseleave},".context-menu-list").on("mouseup.contextMenu",".context-menu-input",g.inputClick).on(c,".context-menu-item"),u=!0}switch(o.on("contextmenu"+n.ns,n.selector,n,g.contextmenu),s&&o.on("remove"+n.ns,function(){m(this).contextMenu("destroy")}),n.trigger){case"hover":o.on("mouseenter"+n.ns,n.selector,n,g.mouseenter).on("mouseleave"+n.ns,n.selector,n,g.mouseleave);break;case"left":o.on("click"+n.ns,n.selector,n,g.click)}n.build||b.create(n);break;case"destroy":var l;if(s){var r=n.context;m.each(h,function(e,t){if(!t)return!0;if(!m(r).is(t.selector))return!0;(l=m(".context-menu-list").filter(":visible")).length&&l.data().contextMenuRoot.$trigger.is(m(t.context).find(t.selector))&&l.trigger("contextmenu:hide",{force:!0});try{h[t.ns].$menu&&h[t.ns].$menu.remove(),delete h[t.ns]}catch(e){h[t.ns]=null}return m(t.context).off(t.ns),!0})}else if(n.selector){if(f[n.selector]){(l=m(".context-menu-list").filter(":visible")).length&&l.data().contextMenuRoot.$trigger.is(n.selector)&&l.trigger("contextmenu:hide",{force:!0});try{h[f[n.selector]].$menu&&h[f[n.selector]].$menu.remove(),delete h[f[n.selector]]}catch(e){h[f[n.selector]]=null}a.off(f[n.selector])}}else a.off(".contextMenu .contextMenuAutoHide"),m.each(h,function(e,t){m(t.context).off(t.ns)}),f={},p=0,u=!(h={}),m("#context-menu-layer, .context-menu-list").remove();break;case"html5":(!m.support.htmlCommand&&!m.support.htmlMenuitem||"boolean"==typeof t&&t)&&m('menu[type="context"]').each(function(){this.id&&m.contextMenu({selector:"[contextmenu="+this.id+"]",items:m.contextMenu.fromMenu(this)})}).css("display","none");break;default:throw new Error('Unknown operation "'+e+'"')}return this},m.contextMenu.setInputValues=function(e,n){void 0===n&&(n={}),m.each(e.inputs,function(e,t){switch(t.type){case"text":case"textarea":t.value=n[e]||"";break;case"checkbox":t.selected=!!n[e];break;case"radio":t.selected=(n[t.radio]||"")===t.value;break;case"select":t.selected=n[e]||""}})},m.contextMenu.getInputValues=function(e,n){return void 0===n&&(n={}),m.each(e.inputs,function(e,t){switch(t.type){case"text":case"textarea":case"select":n[e]=t.$input.val();break;case"checkbox":n[e]=t.$input.prop("checked");break;case"radio":t.$input.prop("checked")&&(n[t.radio]=t.value)}}),n},m.contextMenu.fromMenu=function(e){var t={};return function s(i,e,c){return c=c||0,e.each(function(){var e,t,n=m(this),a=this,o=this.nodeName.toLowerCase();switch("label"===o&&n.find("input, textarea, select").length&&(e=n.text(),o=(a=(n=n.children().first()).get(0)).nodeName.toLowerCase()),o){case"menu":t={name:n.attr("label"),items:{}},c=s(t.items,n.children(),c);break;case"a":case"button":t={name:n.text(),disabled:!!n.attr("disabled"),callback:function(){n.click()}};break;case"menuitem":case"command":switch(n.attr("type")){case void 0:case"command":case"menuitem":t={name:n.attr("label"),disabled:!!n.attr("disabled"),icon:n.attr("icon"),callback:function(){n.click()}};break;case"checkbox":t={type:"checkbox",disabled:!!n.attr("disabled"),name:n.attr("label"),selected:!!n.attr("checked")};break;case"radio":t={type:"radio",disabled:!!n.attr("disabled"),name:n.attr("label"),radio:n.attr("radiogroup"),value:n.attr("id"),selected:!!n.attr("checked")};break;default:t=void 0}break;case"hr":t="-------";break;case"input":switch(n.attr("type")){case"text":t={type:"text",name:e||l(a),disabled:!!n.attr("disabled"),value:n.val()};break;case"checkbox":t={type:"checkbox",name:e||l(a),disabled:!!n.attr("disabled"),selected:!!n.attr("checked")};break;case"radio":t={type:"radio",name:e||l(a),disabled:!!n.attr("disabled"),radio:!!n.attr("name"),value:n.val(),selected:!!n.attr("checked")};break;default:t=void 0}break;case"select":t={type:"select",name:e||l(a),disabled:!!n.attr("disabled"),selected:n.val(),options:{}},n.children().each(function(){t.options[this.value]=m(this).text()});break;case"textarea":t={type:"textarea",name:e||l(a),disabled:!!n.attr("disabled"),value:n.val()};break;case"label":break;default:t={type:"html",html:n.clone(!0)}}t&&(i["key"+ ++c]=t)}),c}(t,m(e).children()),t},m.contextMenu.defaults=v,m.contextMenu.types=x,m.contextMenu.handle=g,m.contextMenu.op=b,m.contextMenu.menus=h});